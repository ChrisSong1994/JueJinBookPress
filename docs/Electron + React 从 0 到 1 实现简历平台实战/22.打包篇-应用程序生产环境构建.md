# 22.æ‰“åŒ…ç¯‡-åº”ç”¨ç¨‹åºç”Ÿäº§ç¯å¢ƒæ„å»º

## å‰è¨€

æˆªè‡³ç›®å‰ï¼Œæˆ‘ä»¬å·²å°†æ•´ä¸ªç®€å†å¹³å°å¼€å‘å®Œæ¯•ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å®ç°åº”ç”¨ç¨‹åºçš„ç”Ÿäº§ç¯å¢ƒæ‰“åŒ…æ„å»ºã€‚ç›¸å¯¹äº[ç¬¬åå››ç« ](https://juejin.cn/book/6950646725295996940/section/6972047382494052392)è€Œè¨€ï¼Œæœ¬ç« èŠ‚çš„ç›¸å…³é…ç½®æ›´ä¸ºå…¨é¢ä¸è¯¦ç»†ã€‚å¦‚æœä½ å¯¹æœ¬ç« èŠ‚å†…å®¹å…´è¶£ä¸å¤§ï¼Œå¯ä»¥å¿«é€Ÿé˜…è¯»æˆ–è·³è¿‡ã€‚

æœ¬ç« èŠ‚çš„ä¸»è¦ç›®çš„æ˜¯ï¼š

- å®ç° Electron ç”Ÿäº§ç¯å¢ƒçš„æ„å»ºæ‰“åŒ…
- å®ç° React ç”Ÿäº§ç¯å¢ƒçš„æ„å»ºæ‰“åŒ…
- é€šè¿‡ Electron-Builder æ‰“åŒ…ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶
- è§£å†³é‡åˆ°çš„ä¸€ç³»åˆ—é—®é¢˜
- ç”Ÿæˆä¸åŒå¹³å°çš„å¯æ‰§è¡Œæ–‡ä»¶

> åŒæ—¶æ­¤é…ç½®å°†ä¼šæ˜¯åç»­ [Webpack æ‰“åŒ…ä¼˜åŒ–](https://juejin.cn/book/6950646725295996940/section/6962941321325576226)ã€[Electron æ‰“åŒ…ä½“ç§¯ä¼˜åŒ–](https://juejin.cn/book/6950646725295996940/section/6962941003858706436)çš„é“ºå«ï¼Œæ¥ä¸‹æ¥çš„ä¸¤ç« å°†ä»¥æ­¤é…ç½®è¿›è¡Œä¼˜åŒ–ã€‚

## ææ¸…æ¥š Electron ä¸ React çš„å…³ç³»

**æ­¤å…³ç³»å·²åœ¨[ğŸ’¥ ç¬¬å››ç« -å¼€å‘å‰å¿…è¯»ï¼Electron ä¸ React çš„å…³ç³»](https://juejin.cn/book/6950646725295996940/section/6961586491285831720)è¿›è¡Œè¯´æ˜**ï¼Œå¤§å®¶å…ˆå»ææ¸…æ¥šå…³ç³»ä¹‹åï¼ˆé˜…è¯»æ—¶é•¿ 3 åˆ†é’Ÿï¼‰ï¼Œå†è¿”å›çœ‹ç»§ç»­é˜…è¯»ã€‚

### æœ¬åœ°å¼€å‘

å½“æˆ‘ä»¬åœ¨æœ¬åœ°å¼€å‘æ—¶ï¼Œè¿è¡Œçš„è„šæœ¬å‘½ä»¤æ˜¯ï¼š

```js
npm run start:main // è¿è¡Œä¸»è¿›ç¨‹
npm run start:render // è¿è¡Œæ¸²æŸ“è¿›ç¨‹
```

react é€šè¿‡ `webpack-dev-server` èµ·äº†ä¸€ä¸ªæœ¬åœ°æœåŠ¡ï¼Œæˆ‘ä»¬é€šè¿‡ `http://127.0.0.1:7001` å°±èƒ½è®¿é—®æˆ‘ä»¬çš„ç«™ç‚¹ã€‚Electron æ˜¯é€šè¿‡ BrowserWindow åˆ›å»ºäº†ä¸€ä¸ªæµè§ˆå™¨çª—å£ï¼Œæ­¤çª—å£é€šè¿‡ loadURL åŠ è½½äº†æˆ‘ä»¬çš„åœ°å€ï¼ˆä½ å¯ä»¥ç†è§£æˆ webview å½¢å¼ï¼‰ï¼Œä»è€Œæ˜¾ç¤ºæˆ‘ä»¬çš„ç½‘é¡µã€‚

```js
// åˆ›å»ºæµè§ˆå™¨çª—å£
const mainWindow = new BrowserWindow({
  width: 1200,
  height: 800,
  webPreferences: {
    devTools: true,
    nodeIntegration: true,
  },
});

if (isDev()) {
  // å¼€å‘ç¯å¢ƒ
  mainWindow.loadURL(`http://127.0.0.1:7001`);
} else {
  // ç”Ÿäº§ç¯å¢ƒ
  mainWindow.loadURL(`file://${path.join(__dirname, '../dist/index.html')}`);
}
```

### æ‰“åŒ…æ„å»º

å½“æˆ‘ä»¬æœ¬åœ°å¼€å‘å®Œæˆä¹‹åï¼Œéœ€è¦æ‰“åŒ…ä¸Šçº¿ï¼Œéœ€è¦è·‘ä»€ä¹ˆå‘½ä»¤ï¼Ÿä¸è¦æƒ³å¤ªå¤æ‚ã€‚å®ƒä»¬ä¹Ÿæ˜¯åˆ†å¼€æ‰“åŒ…çš„

```js
npm run build:main // æ‰“åŒ…ä¸»è¿›ç¨‹ï¼ˆå¯¹ app/main/electron.tsè¿›è¡Œæ‰“åŒ… ï¼‰
npm run build:render // æ‰“åŒ…æ¸²æŸ“è¿›ç¨‹ï¼ˆä¹Ÿå°±æ˜¯å¯¹ React è¿›è¡Œæ‰“åŒ…ï¼‰
```

æ‰“åŒ…ä¹‹åï¼Œæˆ‘ä»¬ dist ç›®å½•å°±ä¼šå­˜åœ¨ç›¸åº”çš„èµ„æºæ–‡ä»¶ã€‚å¦‚ index.htmlã€electron.js ç­‰ã€‚

### ä¸¤è€…å…³ç³»

æé—®ï¼šæŠ›å¼€ Electronï¼Œæˆ‘ä»¬å¸¸è§„çš„ React é¡¹ç›®ï¼Œåœ¨æ‰“åŒ…ä¹‹åï¼Œå¦‚ä½•è¿è¡Œï¼Ÿ

æˆ‘ä»¬æ˜¯é€šè¿‡ç‚¹å‡» dist ä¸‹çš„ index.html å°±èƒ½åœ¨æµè§ˆå™¨é¡µé¢ä¸­æ‰“å¼€çœ‹æ•ˆæœï¼ˆå¦‚æœä½ å‘ç°æ²¡æ•ˆæœï¼Œè¯·ç¡®ä¿æ˜¯ä»¥ç›¸å¯¹è·¯å¾„åŠ è½½èµ„æºæ–‡ä»¶ï¼‰ä½†å¦‚æœç»“åˆäº† Electronï¼Œé‚£ä¹ˆæ­¤æ—¶ç‚¹å‡» dist ä¸‹çš„ index.htmlï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼Œä¸€èˆ¬éƒ½ä¼šå‡ºé”™çš„ã€‚

å¦‚ä½•ç†è§£ï¼ŸElectron å®ƒå†…ç½®äº† Chromium å’Œ Nodeï¼Œè¯•æƒ³ä¸€ä¸‹ï¼Œä½ èƒ½åœ¨ Chrome æµè§ˆå™¨çš„æ§åˆ¶å°ä¸­è¾“å‡º `process` å—ï¼Ÿå¹¶ä¸èƒ½ï¼Œå®ƒä¼šæŠ¥é”™ã€‚

![image.png](./images/9a97688da75505387bc1bef073b8d748.webp )

ä½†å¦‚æœä½ æ˜¯é€šè¿‡ Electron çš„ BrowserWindow åˆ›å»ºçš„æµè§ˆå™¨çª—å£ï¼Œå»æ‰“å° `process`ï¼Œå°±èƒ½æ˜¾ç¤ºå†…å®¹

![image.png](./images/3dcfb4a62ca4e8563f5b80ceb485701c.webp )

è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ Electron é¡¹ç›®ä¸­ dist ä¸‹çš„ index.html ä¸èƒ½ç›´æ¥åœ¨ Chrome æµè§ˆå™¨è¿è¡Œï¼Œå› ä¸ºä½ çš„ä»£ç ï¼Œå¯èƒ½ç”¨åˆ°äº† Electron APIã€Node APIï¼ŒChrome æµè§ˆå™¨æ— æ³•è¯†åˆ«è¿™æ˜¯ä»€ä¹ˆä¸œè¥¿ã€‚**åªæœ‰é€šè¿‡ Electron ç”Ÿæˆçš„æµè§ˆå™¨çª—å£ï¼ŒLoadURL åŠ è½½æ­¤é¡µé¢ï¼Œæ‰èƒ½æ­£å¸¸è¿è¡Œã€‚**

é€šè¿‡å‰é¢çš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬ LoadURL çš„æ˜¯ dist ä¸‹çš„ index.html

```js
if (isDev()) {
  // å¼€å‘ç¯å¢ƒ
  mainWindow.loadURL(`http://127.0.0.1:7001`);
} else {
  // ç”Ÿäº§ç¯å¢ƒ
  mainWindow.loadURL(`file://${path.join(__dirname, '../dist/index.html')}`);
}
```

ææ¸…æ¥šäº†ä»–ä»¬çš„å…³ç³»ä¹‹åï¼Œæ¥ä¸‹æ¥è¯¥ä¸Šä¸»èœäº†ã€‚

## ğŸ”¨ åŠ¨æ‰‹å®è·µ-æ‰“åŒ…æ„å»º

ææ¸…æ¥šä¸Šè¿°è¿œç¦»ä¹‹åï¼Œæˆ‘ä»¬åªéœ€è¦åˆ†åˆ«å®ç° Electron æ‰“åŒ…å’Œ React æ‰“åŒ…å³å¯ï¼Œæ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ä¸€æ­¥æ­¥åŠ¨æ‰‹å®è·µã€‚

### ç¬¬ä¸€æ­¥ï¼šé‡æ–°åˆ’åˆ† Webpack ç›®å½•

å›è¿‡å¤´å»çœ‹æˆ‘ä»¬çš„ `webpack` ç›®å½•ï¼Œå­˜åœ¨ä¸‰ä¸ªæ–‡ä»¶

![image.png](./images/67d3c6a427e1388121ecb37a2c139bf0.webp )

ä½†è¿™æ˜¯æˆ‘ä»¬å¼€å‘ç¯å¢ƒä¸‹æ‰€éœ€çš„é…ç½®ï¼Œä¸ºæ­¤æˆ‘ä»¬éœ€è¦æ–°å¢ç”Ÿäº§ç¯å¢ƒä¸‹æ‰“åŒ…æ„å»ºçš„é…ç½®ã€‚

æˆ‘ä»¬åˆ æ‰ `webpack.base.js` æ–‡ä»¶ï¼ŒåŸå› æ˜¯ï¼šæ—¢ç„¶åˆ’åˆ†äº†ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹çš„åˆ†å¼€æ‰“åŒ…ï¼Œæˆ‘è®¤ä¸ºæ²¡å¿…è¦å°†ä¸¤è€…çš„é€šç”¨å†…å®¹åˆ’åˆ†åˆ°ä¸€å—ã€‚

**æˆ‘ä»¬æŠŠä¸Šé¢çš„ä¸‰ä¸ªæ–‡ä»¶éƒ½åˆ é™¤ï¼Œé‡æ–°æ¥é…ç½®ä¸€ä¸‹ Electron ä¸ React çš„ç›¸å…³æ‰“åŒ…å†…å®¹ã€‚è®°å¾—çœ‹æ³¨é‡Š**

#### ğŸ‚ Electron æ–¹é¢

æ–°å¢ä¸‰ä¸ªæ–‡ä»¶

- `webpack.main.base.js` åŸºç¡€é…ç½®
- `webpack.main.dev.base.js` å¼€å‘ç¯å¢ƒä¸‹çš„é…ç½®
- `webpack.main.prod.base.js` ç”Ÿäº§ç¯å¢ƒä¸‹çš„é…ç½®

```js
// webpack/webpack.main.base.js

const path = require('path');
const webpack = require('webpack');

module.exports = {
  entry: path.resolve(__dirname, '../app/main/electron.ts'),
  output: {
    filename: 'electron.js',
    path: path.resolve(__dirname, '../dist'),
  },
  target: 'electron-main',
  devtool: 'inline-source-map',
  resolve: {
    // ä¸»è¿›ç¨‹ä¸ä¼šå­˜åœ¨ jsxã€tsxï¼Œæ‰€ä»¥ä¸ç”¨é…ç½®è¿™äº›åç¼€
    // è‡³äºä¸ºä»€ä¹ˆä¸éœ€è¦ï¼Œä¼šåœ¨ä¸‹ä¸€ç« èŠ‚ä¼˜åŒ–å¤„è¯´æ˜
    extensions: ['.js', '.ts'],
  },
  module: {
    rules: [
      {
        test: /\.(js|ts)$/,
        exclude: /node_modules/,
        use: {
          loader: 'babel-loader',
        },
      },
    ],
  },
  plugins: [
    // ç”¨äºæ‰“åŒ…åçš„ä¸»è¿›ç¨‹ä¸­æ­£ç¡®è·å–__dirname
    new webpack.DefinePlugin({
      __dirname: '__dirname',
    }),
  ],
};
```

Electron æ–¹é¢çš„åŸºç¡€é…ç½®å·²ç»é…å¥½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹`å¼€å‘ç¯å¢ƒ`å’Œ`ç”Ÿäº§ç¯å¢ƒ`çš„é…ç½®

```js
// webpack/webpack.main.dev.js

const webpackMerge = require('webpack-merge');
const mainBaseConfig = require('./webpack.main.base.js');

const devConfig = {
  mode: 'development',
};

module.exports = webpackMerge.merge(mainBaseConfig, devConfig);
```

```js
// webpack/webpack.main.prod.js

const webpackMerge = require('webpack-merge');
const mainBaseConfig = require('./webpack.main.base.js');

const prodConfig = {
  mode: 'production',
};

module.exports = webpackMerge.merge(mainBaseConfig, prodConfig);
```

#### ğŸ· React æ–¹é¢

æ–°å¢ä¸‰ä¸ªæ–‡ä»¶

- `webpack.render.base.js` åŸºç¡€é…ç½®
- `webpack.render.dev.base.js` å¼€å‘ç¯å¢ƒä¸‹çš„é…ç½®
- `webpack.render.prod.base.js` ç”Ÿäº§ç¯å¢ƒä¸‹çš„é…ç½®

```js
// webpack/webpack.render.base.js

const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');

module.exports = {
  // å¤šå…¥å£ï¼Œè¿™åœ¨ç¬¬åä¸ƒç« æœ‰è®²è§£
  entry: {
    index: path.resolve(__dirname, '../app/renderer/app.tsx'),
    setting: path.resolve(
      __dirname,
      '../app/renderer/windowPages/setting/app.tsx'
    ),
  },
  output: {
    filename: '[name].[hash].js',
    path: path.resolve(__dirname, '../dist'),
  },
  resolve: {
    // è¿™é‡Œå°±éœ€è¦ jsx å’Œ tsx äº†
    extensions: ['.js', '.jsx', '.ts', '.tsx'],
    // åˆ«åé…ç½®ï¼Œåœ¨ Electron ä¸­å¹¶æœªç”¨åˆ°åˆ«åè·¯å¾„ï¼Œæ‰€ä»¥æ‹†åˆ° React è¿™è¾¹çš„é…ç½®ä¸­
    alias: {
      '@assets': path.join(__dirname, '../', 'assets/'),
      '@src': path.join(__dirname, '../', 'app/renderer'),
      '@common': path.join(__dirname, '../', 'app/renderer/common'),
    },
  },
  target: 'electron-renderer',
  devtool: 'inline-source-map',
  module: {
    rules: [
      {
        test: /\.(js|jsx|ts|tsx)$/,
        exclude: /node_modules/,
        use: {
          loader: 'babel-loader',
        },
      },
      {
        test: /\.(jpg|png|jpeg|gif)$/,
        use: [
          {
            loader: 'file-loader',
            options: {
              name: '[name]_[hash].[ext]',
              outputPath: 'images/',
            },
          },
        ],
      },
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader', 'postcss-loader'],
      },
      {
        test: /\.less$/,
        exclude: /node_modules/,
        use: [
          'style-loader',
          {
            loader: 'css-loader',
            options: {
              modules: {
                localIdentName: '[name]__[local]__[hash:base64:5]',
              },
            },
          },
          'postcss-loader',
          'less-loader',
        ],
      },
    ],
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: path.resolve(__dirname, '../app/renderer/index.html'),
      filename: path.resolve(__dirname, '../dist/index.html'),
      chunks: ['index'],
    }),
    new HtmlWebpackPlugin({
      template: path.resolve(__dirname, '../app/renderer/windowPages/setting/index.html'),
      filename: path.resolve(__dirname, '../dist/setting.html'),
      chunks: ['setting'],
    }),
  ],
};
```

React æ–¹é¢çš„åŸºç¡€é…ç½®å·²ç»é…å¥½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹`å¼€å‘ç¯å¢ƒ`å’Œ`ç”Ÿäº§ç¯å¢ƒ`çš„é…ç½®

å› ä¸ºæˆ‘ä»¬åœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼Œé€šè¿‡ webpack-dev-server èµ·äº†ä¸€ä¸ªæœ¬åœ°æœåŠ¡ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„å¼€å‘ç¯å¢ƒé…ç½®åº”ä¸º

```js
// webpack/webpack.render.dev.js

const path = require('path');
const webpackMerge = require('webpack-merge');
const renderBaseConfig = require('./webpack.render.base.js');

const devConfig = {
  mode: 'development',
  devServer: {
    contentBase: path.join(__dirname, '../dist'),
    compress: true,
    host: '127.0.0.1', // webpack-dev-serverå¯åŠ¨æ—¶è¦æŒ‡å®šipï¼Œä¸èƒ½ç›´æ¥é€šè¿‡localhostå¯åŠ¨ï¼Œä¸æŒ‡å®šä¼šæŠ¥é”™
    port: 7001, // å¯åŠ¨ç«¯å£ä¸º 7001 çš„æœåŠ¡
    hot: true,
  },
};

module.exports = webpackMerge.merge(renderBaseConfig, devConfig);
```

```js
// webpack/webpack.render.prod.js

const webpackMerge = require('webpack-merge');
const renderBaseConfig = require('./webpack.render.base.js');

const prodConfig = {
  mode: 'production',
};

module.exports = webpackMerge.merge(renderBaseConfig, prodConfig);
```

#### æ·»åŠ æ‰“åŒ…å‘½ä»¤

å‰å¾€ `package.json`ï¼Œæˆ‘ä»¬ä¸ºå…¶æ·»åŠ ä¸€ä¸‹æ‰“åŒ…æ„å»ºçš„è„šæœ¬å‘½ä»¤

```json
"scripts": {
  // æœ¬åœ°å¼€å‘
  "start:main": "webpack --config ./webpack/webpack.main.dev.js && electron ./dist/electron.js",
  "start:render": "webpack-dev-server --config ./webpack/webpack.render.dev.js",
  // ğŸ‘‡ æ–°å¢çš„ç”Ÿäº§æ‰“åŒ…å‘½ä»¤
  "build:main": "webpack --config ./webpack/webpack.main.prod.js",
  "build:render": "webpack --config ./webpack/webpack.render.prod.js",
},
```

æœ€ç»ˆæˆ‘ä»¬çš„ `webpack` æ–‡ä»¶å¤¹æ˜¯è¿™æ ·çš„

![image.png](./images/a6f24252352caaed248ca5d8fc4623c1.webp )

### ç¬¬äºŒæ­¥ï¼šå®‰è£… electron-builder

è¿™è¾¹æˆ‘ä»¬é€šè¿‡ `electron-builder` è¿›è¡Œæ‰“åŒ…ï¼Œæ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œæˆ‘ä»¬è¿›è¡Œå®‰è£…

```
npm install electron-builder --save-dev
```

![image.png](./images/c94c4300f29d4cf45773dd3638070e79.webp )

### ç¬¬ä¸‰æ­¥ï¼šæ·»åŠ æ‰“åŒ…å‘½ä»¤è¿›è¡Œæ‰“åŒ…

ç”±äºå¾ˆå¤šå±æ€§ï¼Œä¸€ä¸€ç»†è®²å¹¶ä¸ç°å®ï¼Œå°ä¼™ä¼´å¯ä»¥å‰å¾€ [electron-builder å®˜æ–¹æ–‡æ¡£](https://www.electron.build/configuration/configuration) é˜…è¯»ã€‚

é€šè¿‡å®˜æ–¹æ–‡æ¡£çš„ [å¿«é€Ÿä¸Šæ‰‹](https://www.electron.build/#quick-setup-guide)ï¼Œåªéœ€è¦æ·»åŠ å¯¹åº”çš„ä¸€äº›é…ç½®å³å¯å®ç°æ‰“åŒ…ã€‚

é¦–å…ˆæˆ‘ä»¬åœ¨ `package.json` ä¸­æ·»åŠ  build å±æ€§ï¼Œç´§æ¥ç€æ·»åŠ  PC æ‰“åŒ…æ„å»ºå‘½ä»¤

```json
{
  "scripts": {
    // ğŸ‘‡ æ–°å¢çš„PCæ„å»ºæ‰“åŒ…å‘½ä»¤
    // ç›´æ¥ç”Ÿæˆä¸€ä¸ªå®‰è£…å®Œæ¯•çš„ç¨‹åºï¼Œèƒ½ç›´æ¥è¿è¡Œï¼Œè€Œä¸æ˜¯å®‰è£…åŒ…
    "pack": "electron-builder --dir",
    // è¿™ä¸ªå‘½ä»¤æ˜¯ç”ŸæˆçœŸæ­£çš„å®‰è£…åŒ…
    "dist": "electron-builder"
  },
  // ğŸ‘‡ æ–°å¢æ‰“åŒ…ç›¸å…³çš„åº”ç”¨ä¿¡æ¯
  "build": {
    "appId": "visResumeMook.ElectronReact", // è‡ªå®šä¹‰ appId
    "productName": "VisResumeMook", // æ‰“åŒ…ä¹‹åçš„ç¨‹åºå
    "copyright": "Copyright Â© 2019 ${author}",
    // https://www.electron.build/configuration/contents.html#files
    // æ‰“åŒ…çš„ app.asar ä¸­åŒ…å«å“ªäº›æ–‡ä»¶ï¼Œåˆ°æ—¶å€™è§£å‹å‡ºæ¥å°±æ˜¯å“ªäº›æ–‡ä»¶
    "files": ["dist/**/*", "package.json", "node_modules/"],
    // æ„å»ºçš„å¯æ‰§è¡Œæ–‡ä»¶æ”¾åœ¨ package ç›®å½•ä¸‹
    "directories": {
      "output": "package"
    }
  }
}
```

è¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œæ‰“åŒ…äº†ã€‚ä¸€ä¸ªå®Œæ•´çš„æ‰“åŒ…æ„å»ºå‘½ä»¤ä¸ºï¼š

```js
// 1. åˆ é™¤ä¸Šä¸€è½®æ‰“åŒ…çš„ dist ç›®å½•å’Œ package ç›®å½•
rm -rf dist package
// 2. æ„å»ºæ‰“åŒ…Elctron
npm run build:main
// 3. æ„å»ºæ‰“åŒ… React
npm run build:render
// 4. é€šè¿‡ electron-builder æ„å»ºå®‰è£…åŒ…
//ï¼ˆå¦‚æœä½ çš„é™æ€èµ„æºæ²¡å‘ç”Ÿæ”¹å˜ï¼Œå¯ä»¥ç›´æ¥ packï¼Œä¸ç”¨å†é‡æ–°æ‰“åŒ…ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹ï¼‰
npm run pack
```

è¿è¡Œä¸€ä¸‹ï¼Œå‘ç°æŠ¥é”™äº†

![image.png](./images/78b36476f1c058a881b3139595126208.webp )

æˆ‘ä»¬å°† electron æ”¾åˆ° devDependencies ä¸­

```json
{
  "dependencies": {
    // ğŸ‘‡ å°†å…¶æ”¾åœ¨ devDependencies ä¸­
    // "electron": "^11.1.1"
  },
  "devDependencies": {
    "electron": "^11.1.1"
  }
}
```

é‡æ–° installï¼Œå†æ‰§è¡Œä¸€ä¸‹å‘½ä»¤ `npm run pack` (å› ä¸ºè¿™é‡Œæˆ‘çš„é™æ€èµ„æºæ²¡å‘ç”Ÿæ”¹å˜ï¼Œå¯ä»¥ç›´æ¥ packï¼Œä¸ç”¨å†é‡æ–°æ‰“åŒ…ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹)

æ‰§è¡Œç»“æœè¿˜æ˜¯å‡ºé”™ï¼ŒåŸå› åœ¨äºæˆ‘ä»¬çš„åº”ç”¨å…¥å£æ–‡ä»¶å†™é”™äº†

![image.png](./images/e867fd8a92c2010324490ed71e13a106.webp )

æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹ package.json ä¸­çš„ main å±æ€§ï¼Œæœç„¶æœ‰é—®é¢˜ï¼Œè¿›è¡Œä¿®æ”¹

```json
{
  // ğŸ‘‡ ä¿®æ”¹æˆæ‰“åŒ…åçš„å…¥å£æ–‡ä»¶
  "main": "./dist/electron.js"
}
```

å†è¯•ä¸€æ¬¡ï¼Œ`npm run pack`ï¼Œå‘ç°è¿™æ¬¡æ²¡é—®é¢˜äº†ã€‚ç¨³å¦¥

![image.png](./images/13e6d7d3d88d3a02b2685cb07b6b7e24.webp )

è¿›å…¥åˆ° package ç›®å½•ä¸‹ï¼Œæ‰¾åˆ° mac ç›®å½•ï¼Œè¿›å…¥å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶

åŒå‡»æ‰“å¼€ï¼Œå‘ç°å¥½åƒæœ‰äº›é—®é¢˜

![image.png](./images/37576545505fa59fab54c5edc13947df.webp )

![image.png](./images/85212cde43660c5226f75a9240e7698f.webp )

#### ğŸ’¥ Whatï¼Ÿé—®é¢˜å¾ˆå¤š

- æ€ä¹ˆä¸»é¢˜é…è‰²çš„åŠŸèƒ½æ¶ˆå¤±äº†ï¼Ÿæ¢è¨€ä¹‹ï¼Œè¯»å–çš„ `appConfig` æ–‡ä»¶å¥½åƒéƒ½ä¸å­˜åœ¨ï¼Ÿæ­£å› ä¸ºè¯»ä¸åˆ°ï¼Œæ‰€ä»¥æ²¡æœ‰äº†ä¸»é¢˜åˆ—è¡¨

![image.png](./images/1ea1b3f447d972a4f39f9b7a24fe350c.webp )

- ç‚¹å‡»è¿›å…¥`ç®€å†åˆ¶ä½œ` æ¨¡å—æ— ååº”ï¼Ÿ

![image.png](./images/5f7fb7ef1a51467a71684c60eab356cc.webp )

- æ¨¡ç‰ˆåˆ—è¡¨æ€ä¹ˆéƒ½æ²¡å›¾ç‰‡äº†ï¼Œæˆ‘ä»¬ä» `assets/template` æ–‡ä»¶å¤¹ä¸­è¯»å–çš„æ¨¡ç‰ˆå°é¢ï¼Œæ€ä¹ˆä¹Ÿä¸è§äº†å‘¢ï¼Ÿ

![image.png](./images/d1fba7f20d807be9241497fd45982a23.webp )

#### ğŸŒˆ é—®é¢˜ä¸€ä¸ªä¸ªå®šä½è§£å†³

æœ‰æ„æ€ï¼Œè¿™æ‰æ˜¯è¿›æ­¥ï¼Œæ¯•ç«Ÿå¿«é€Ÿå®šä½é—®é¢˜ä¹Ÿæ˜¯ä¸€ç§æŠ€èƒ½ã€‚

**Question1: ä¸»é¢˜åˆ—è¡¨æ¶ˆå¤±**

å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œä¸»é¢˜é…è‰²çš„åŠŸèƒ½æ¶ˆå¤±äº†ï¼Ÿä¸ºä»€ä¹ˆæ²¡æœ‰ä¸»é¢˜åˆ—è¡¨ï¼ŸåŒå‡»æ‰“å¼€åº”ç”¨ï¼Œæˆ‘ä»¬è¿›å…¥åˆ‡åˆ°å¼€å‘è€…å·¥å…·ï¼Œçœ‹çœ‹æ§åˆ¶å°è¾“å‡ºä»€ä¹ˆã€‚

![image.png](./images/1b376123ba8ac4e1a64e137b414e357b.webp )

æœä¸å…¶ç„¶ï¼Œåœ¨[ç¬¬åå…­ç« ](https://juejin.cn/book/6950646725295996940/section/6962761759404851239)æ—¶è®²åˆ°ï¼Œæˆ‘ä»¬çš„ä¸»é¢˜æ˜¯é€šè¿‡è¯»å– `appConfig` ç›®å½•ä¸‹çš„ `theme.config.json` æ–‡ä»¶æ„é€ å‡ºæ¥çš„ä¸»é¢˜åˆ—è¡¨ï¼Œ`appConfig` æ–‡ä»¶å¤¹éƒ½æ‰¾ä¸åˆ°ï¼Œæ€ä¹ˆä¼šæœ‰ä¸»é¢˜åˆ—è¡¨å‘¢ï¼Ÿ

ç™¾æ€ä¸å¾—å…¶è§£ï¼Ÿæ€ä¹ˆä¼šæ²¡æœ‰ appConfig ç›®å½•ï¼Ÿå‰å¾€ dist æ–‡ä»¶å¤¹ç§ä¸€ç§ï¼Œæœç„¶æ²¡æœ‰ï¼

![image.png](./images/54d0a1d69005be093951252618207765.webp )

ä¸ºä»€ä¹ˆä¼šå¦‚æ­¤ï¼Ÿè¦çŸ¥é“ï¼ŒWebpack åªä¼šå°†ä½ æ‰€éœ€è¦çš„èµ„æºè¿›è¡Œæ‰“åŒ…ï¼Œæ¢è¨€ä¹‹ï¼Œå‡¡æ˜¯ä½ é€šè¿‡ `import xxx` çš„èµ„æºå¼•å…¥å¹¶ä½¿ç”¨ï¼Œå°±ä¼šè¢«æ‰“åŒ…åˆ° dist æ–‡ä»¶å¤¹ä¸­ã€‚

**çº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œå¾—çŸ¥æ­¤äº‹è¦èº¬è¡Œ**ï¼Œæˆ‘ä»¬æ¥è¯•ä¸€è¯•ã€‚æˆ‘ä»¬å°±åœ¨ `app/renderer/app.tsx` æ ¹æ–‡ä»¶ä¸‹ï¼Œå¼•å…¥ `assets/template/template1.jpg` æ–‡ä»¶ï¼ˆéªŒè¯ä¸€ä¸‹ï¼‰

```ts
import React from 'react';
import ReactDOM from 'react-dom';
import Router from './router';
import store from './store';
import { Provider } from 'react-redux';

// ğŸ‘‡ âš ï¸ è¿™é‡Œåªæ˜¯å¼•å…¥ template1.jpg å›¾ç‰‡
import TestWebpackJpg from '@assets/template/template1.jpg';

function App() {
  return (
    <Provider store={store}>
      <Router />
    </Provider>
  );
}

ReactDOM.render(<App />, document.getElementById('root'));
```

æ­¤æ—¶æˆ‘ä»¬å†é‡æ–°æ‰“åŒ…ä¸€ä¸‹

```bash
// 1. åˆ é™¤ä¸Šä¸€è½®æ‰“åŒ…çš„ dist ç›®å½•
rm -rf dist
// 2. é‡æ–°æ‰“åŒ… React
npm run build:render
```

å°ä¼™ä¼´ä»¬çŒœä¸€ä¸‹ï¼Œæ­¤æ—¶çš„ `dist/images/` ç›®å½•ä¸‹æ˜¯å¦ä¼šå‡ºç°è¿™å¼ å›¾ç‰‡å‘¢ï¼Ÿ

**è®©æˆ‘æ¥å‘Šè¯‰ä½ ç­”æ¡ˆï¼šå¹¶ä¸ä¼š**ã€‚ä½ å¯ä»¥å‰å¾€ dist ç›®å½•æŸ¥çœ‹ï¼Œä½ ä¼šå‘ç°è¿™å¼ ç…§ç‰‡å¹¶æ²¡æœ‰æ‰“è¿›å»ã€‚æˆ‘ä»¬å°†ä»£ç ç¨ä½œä¿®æ”¹

```ts
import React from 'react';
import ReactDOM from 'react-dom';
import Router from './router';
import store from './store';
import { Provider } from 'react-redux';

// ğŸ‘‡ âš ï¸ å¼•å…¥ template1.jpg å›¾ç‰‡
import TestWebpackJpg from '@assets/template/template1.jpg';

function App() {
  // ğŸ‘‡âš ï¸ æ‰“å°è¿™å¼ å›¾ç‰‡
  console.log(TestWebpackJpg);

  return (
    <Provider store={store}>
      <Router />
    </Provider>
  );
}

ReactDOM.render(<App />, document.getElementById('root'));
```

æ­¤æ—¶æˆ‘ä»¬å†é‡æ–°æ‰“åŒ…ä¸€ä¸‹

```bash
// 1. åˆ é™¤ä¸Šä¸€è½®æ‰“åŒ…çš„ dist ç›®å½•
rm -rf dist
// 2. é‡æ–°æ‰“åŒ… React
npm run build:render
```

å°ä¼™ä¼´ä»¬çŒœä¸€ä¸‹ï¼Œæ­¤æ—¶çš„ `dist/images/` ç›®å½•ä¸‹æ˜¯å¦ä¼šå‡ºç°è¿™å¼ å›¾ç‰‡å‘¢ï¼Ÿå¤šè¯´æ— ç›Šï¼Œæ˜¯éª¡å­æ˜¯é©¬ï¼Œæ‹‰å‡ºæ¥æºœä¸€æºœ

![image.png](./images/3e18fb93f40b5486ebe7e8b22bb1cde9.webp )

æ™®å¤©åŒåº†ï¼Œæˆ‘ä»¬æ˜¯èƒ½åœ¨ `dist/images/` ä¸‹å‘ç°è¿™å¼ å›¾ç‰‡çš„ã€‚è¯´æ˜ Webpack åªä¼šå°†æˆ‘ä»¬ä½¿ç”¨åˆ°çš„ `import` èµ„æºæ‰“åŒ…åˆ° dist ä¸‹ï¼Œé’ˆå¯¹ `appConfig` å’Œ `assets/template` æ ¹æœ¬ä¸ä¼šæ‰“åŒ…ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯é€šè¿‡ NodeJS çš„ fs æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œè¯»å–çš„ï¼Œé—®é¢˜æ¥äº†ï¼Œå¦‚ä½•è®©æ‰“åŒ…ä¹‹åçš„ dist ä¹Ÿèƒ½æœ‰è¿™äº›æ–‡ä»¶å‘¢ï¼Ÿ

åœ¨ç½‘ä¸Šæœç´¢äº†ä¸€äº›æ•™ç¨‹ï¼Œå‘ç°å¦‚è„šæ‰‹æ¶åˆ›å»ºå‡ºæ¥çš„ç›®å½•ï¼Œä¼šå­˜åœ¨ä¸€ä¸ª `public` æ–‡ä»¶å¤¹å­˜æ”¾é™æ€èµ„æºï¼Œå¦‚æœä½ å°†é™æ€èµ„æºæ–‡ä»¶æ”¾å…¥è¯¥ public æ–‡ä»¶å¤¹ï¼Œwebpack å°†ä¸ä¼šå¤„ç†å®ƒï¼Œåœ¨ä½ æ‰“åŒ…çš„æ—¶å€™ï¼Œä¼šå°† `public` æ–‡ä»¶å¤¹ç›´æ¥**å¤åˆ¶**ä¸€ä»½åˆ°ä½ æ„å»ºå‡ºæ¥çš„æ–‡ä»¶å¤¹ä¸­ã€‚

æ‰€ä»¥æˆ‘çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ï¼š**å°†æ‰€éœ€çš„æ–‡ä»¶å¤¹å¤åˆ¶ä¸€ä»½æ”¾åœ¨ `dist` ç›®å½•ä¸‹**ï¼Œå¦‚ä½•å¤åˆ¶ï¼Ÿåœ¨ webpack å®˜æ–¹æ–‡æ¡£ä¸­æœ‰æä¾›ä¸€ä¸ªæ’ä»¶ï¼Œä½¿ç”¨ [copy-webpack-plugin](https://github.com/webpack-contrib/copy-webpack-plugin)å°±èƒ½å®ç°æˆ‘ä»¬çš„éœ€æ±‚ã€‚

æ¥ä¸‹æ¥è®©æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ `webpack.render.base.js` æ–‡ä»¶

```js
// webpack/webpack.render.base.js

/* eslint-disable @typescript-eslint/no-require-imports */
const path = require('path');
const CopyWebpackPlugin = require('copy-webpack-plugin');
const HtmlWebpackPlugin = require('html-webpack-plugin');

module.exports = {
  plugins: [
    // ğŸ‘‡ é€šè¿‡è¯¥æ’ä»¶å®ç°èµ„æºæ–‡ä»¶çš„æ‹·è´
    new CopyWebpackPlugin({
      patterns: [
        {
          from: path.resolve(__dirname, '../assets'),
          to: path.resolve(__dirname, '../dist/assets'),
        },
        {
          from: path.resolve(__dirname, '../appConfig'),
          to: path.resolve(__dirname, '../dist/appConfig'),
        },
      ],
    }),
  ],
};
```

æ­¤æ—¶æˆ‘ä»¬å†é‡æ–°æ‰“åŒ…ä¸€ä¸‹

```bash
// 1. åˆ é™¤ä¸Šä¸€è½®æ‰“åŒ…çš„ dist ç›®å½•
rm -rf dist
// 2. é‡æ–°æ‰“åŒ… React
npm run build:render
```

å¯ä»¥çœ‹åˆ°è¿™æ—¶å€™åœ¨ dist ç›®å½•ä¸‹ï¼Œå·²ç»æœ‰å¯¹åº”çš„æ–‡ä»¶å¤¹ç›®å½•ã€‚

![image.png](./images/26962bbfcd14c782fd137a0dcf308d47.webp )

è¿™æ—¶å€™æ˜¯ä¸æ˜¯é‡æ–°ç”¨ `electron-builder` æ„å»ºä¸€ä¸ªåŒ…ï¼Œå°±å¯ä»¥äº†å‘¢ï¼Ÿè®©æˆ‘ä»¬è¯•è¯•ã€‚èµ°ä¸€ä¸ªå®Œæ•´çš„æ‰“åŒ…æ„å»ºå‘½ä»¤

```js
// 1. åˆ é™¤ä¸Šä¸€è½®æ‰“åŒ…çš„ dist ç›®å½•å’Œ package ç›®å½•
rm -rf dist package
// 2. æ„å»ºæ‰“åŒ…Elctron
npm run build:main
// 3. æ„å»ºæ‰“åŒ… React
npm run build:render
// 4. é€šè¿‡ electron-builder æ„å»ºå®‰è£…åŒ…
//ï¼ˆå¦‚æœä½ çš„é™æ€èµ„æºæ²¡å‘ç”Ÿæ”¹å˜ï¼Œå¯ä»¥ç›´æ¥ packï¼Œä¸ç”¨å†é‡æ–°æ‰“åŒ…ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹ï¼‰
npm run pack
```

æ„å»ºå®Œæ¯•ä¹‹åï¼Œå‰å¾€æŸ¥çœ‹å‘ç°è¿˜æ˜¯ä¸è¡Œï¼Œæ§åˆ¶å°æŠ¥é”™

> Uncaught (in promise) Error: ENOENT: no such file or directory, scandir '/Users/pengdaokuan/Desktop/pdk/visResumeMook/package/mac/VisResumeMook.app/Contents/Resources/assets/template'

æœ‰è¶£ï¼Œè¿™ä¸ªè·¯å¾„ä¸æ­£ç¡®ï¼Œæˆ‘ä»¬æ‰€æœŸæœ›çš„æ˜¯ï¼Œè¿™é‡Œçš„ `assets/template` å‰é¢åº”è¯¥æ˜¯å¸¦æœ‰ä¸€ä¸ª `dist` ç›®å½•çš„ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªå®‰è£…åŒ…çš„ç›¸å…³ä»£ç ï¼Œç”±äº electron æ‰“åŒ…åçš„ä»£ç æ˜¯å‹ç¼©è¿‡åçš„ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶è§£å‹ä¸€ä¸‹ã€‚æˆ‘ä»¬åˆ° `package/mac/VisResumeMook.app/Contents/Resources` ä¸­æ‰¾åˆ° app.asarï¼Œå¯¹å®ƒè¿›è¡Œè§£å‹

```
// 1. å…¨å±€å®‰è£…
npm install -g asar
// 2. åˆ°è¯¥ç›®å½•ä¸‹ï¼Œæ­£ç¡®ç›®å½•è‡ªè¡Œæ‹¼å†™
cd package/mac/VisResumeMook.app/Contents/Resources
// 3. è§£å‹
asar extract app.asar ./
```

![image.png](./images/8a5d3f67e50971bb6af5e167af22c56f.webp )

äº‹å®è¯æ˜æ˜¯å­˜åœ¨çš„ï¼Œé‚£åˆ°åº•æ˜¯ä»€ä¹ˆé—®é¢˜å¯¼è‡´æ²¡æœ‰çš„å‘¢ï¼Ÿæˆ‘ä»¬å†æ³¨æ„çœ‹çœ‹æŠ¥é”™ä¿¡æ¯ï¼Œ**ä¸»è¦é—®é¢˜å°±æ˜¯è·¯å¾„é—®é¢˜**ï¼Œæˆ‘ä»¬é€šè¿‡æ–­ç‚¹æ¥çœ‹çœ‹ `appConfig` çš„ç»å¯¹è·¯å¾„æ˜¯ä»€ä¹ˆã€‚è¿›å…¥åˆ°æ§åˆ¶å°ï¼Œæ‰¾åˆ° `Sources` ï¼Œç„¶åå¯¹ `useThemeActionHooks.ts` æ–‡ä»¶æ‰“ä¸Šç«¯ç‚¹ã€‚

![image.png](./images/6096e2b63ed18a6f264ea37e45848613.webp )

ç„¶åæˆ‘ä»¬åˆ·æ–°ä¸€ä¸‹é¡µé¢ï¼Œæˆ‘ä»¬é¼ æ ‡æ‚¬æµ®åˆ° `appPath` ä¸Šï¼Œçœ‹çœ‹è¾“å‡ºçš„æ˜¯ä»€ä¹ˆ

![image.png](./images/23763f5feaecf16ef635b1cdf16b7df8.webp )

å¥½å®¶ä¼™ï¼Œè¿™è·¯å¾„å¾ˆæ˜æ˜¾ä¸æ­£ç¡®ï¼Œå¦‚æœä½ è¿˜è®°å¾— `getAppPath()` æ–¹æ³•è·å–åº”ç”¨ç¨‹åºçš„è·¯å¾„ï¼Œæƒ³å¿…ä¸ä¼šå¿˜è®°æˆ‘ä»¬æ˜¯é€šè¿‡ **app.getAppPath()** æ–¹æ³•è·å–çš„ï¼Œè¿™ä¸ª API å¾—åˆ°çš„æ˜¯åœ¨æ–‡ä»¶ç®¡ç†å™¨ä¸­çš„åº”ç”¨ç¨‹åºè·¯å¾„ã€‚è€Œæˆ‘ä»¬æœŸæœ›å¾—åˆ°çš„æ˜¯å¸¦æœ‰ `app.aras/dist` è¿™æ ·çš„ä¸€ä¸ªè·¯å¾„ã€‚æ‰€ä»¥è¯´é€šè¿‡è¿™ä¸ª API è·å–æ˜¯ä¸æ­£ç¡®çš„ï¼Œé‚£è¯¥é€šè¿‡ä»€ä¹ˆè·å–å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯ `__dirname`

æˆ‘ä»¬åœ¨æ§åˆ¶å°æ‰“å°ä¸€ä¸‹ `__dirname`ï¼Œçœ‹çœ‹ç»“æœæ˜¯ä»€ä¹ˆã€‚

![image.png](./images/0b41e38025f8367e340ebe5cf7b69d3c.webp )

è¿™æ—¶å€™å†å»æ‰¾ dist ä¸‹çš„ appConfig æ˜¯ä¸æ˜¯å°±è¡Œäº†ï¼Ÿæ‰€ä»¥é—®é¢˜åˆ‡åˆ°äº†ï¼Œå¦‚ä½•å¾—åˆ°æ­£ç¡®çš„è·¯å¾„ã€‚æˆ‘ä»¬è‚¯å®šä¸æ„¿å†æ”¹ `getAppPath()` æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ”¹ä¸»è¿›ç¨‹ä¸­ï¼Œipc å“åº”çš„æ•°æ®å³å¯ã€‚

```js
// app/main/electron.ts

// getAppPath() æ–¹æ³•ä¸»è¦æ˜¯é€šè¿‡ ipc é€šä¿¡ï¼Œå¾—åˆ°é¡¹ç›®è·¯å¾„ï¼Œæˆ‘ä»¬å°† __dirname çš„è·¯å¾„è¿”å›
ipcMain.on('get-root-path', (event, arg) => {
  event.reply('reply-root-path', __dirname);
});
```

è®©æˆ‘ä»¬èµ°ä¸€ä¸ªå®Œæ•´çš„æ‰“åŒ…æ„å»ºå‘½ä»¤

```js
// 1. åˆ é™¤ä¸Šä¸€è½®æ‰“åŒ…çš„ dist ç›®å½•å’Œ package ç›®å½•
rm -rf dist package
// 2. æ„å»ºæ‰“åŒ…Elctron
npm run build:main
// 3. æ„å»ºæ‰“åŒ… React
npm run build:render
// 4. é€šè¿‡ electron-builder æ„å»ºå®‰è£…åŒ…
//ï¼ˆå¦‚æœä½ çš„é™æ€èµ„æºæ²¡å‘ç”Ÿæ”¹å˜ï¼Œå¯ä»¥ç›´æ¥ packï¼Œä¸ç”¨å†é‡æ–°æ‰“åŒ…ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹ï¼‰
npm run pack
```

ç„¶åè¿›å…¥ `package/mac` åŒå‡»åº”ç”¨ç¨‹åºï¼Œç„¶åçœ‹åˆ°é¦–é¡µå°±æœ‰ç®€å†åˆ—è¡¨å•¦ï½

![image.png](./images/c2a1f89b8cf5d11cc4bd51483f434d44.webp )

**Quesiton2: ç®€å†æ¨¡ç‰ˆåˆ—è¡¨æ²¡æœ‰å°é¢**

ä¸Šä¸€ä¸ªé—®é¢˜è§£å†³äº†ï¼Œè¿™ä¸ªé—®é¢˜åº”è¯¥ä¹Ÿä¸éš¾ï¼Œæˆ‘ä»¬è¿›å…¥åˆ°æ¨¡ç‰ˆåˆ—è¡¨ï¼Œå‘ç°è¿˜æ˜¯æ²¡æœ‰å°é¢ï¼ŒåŸå› ç«Ÿç„¶æ˜¯

> Uncaught (in promise) Error: ENOENT, distassets/template not found in /Users/pengdaokuan/Desktop/pdk/visResumeMook/package/mac/VisResumeMook.app/Contents/Resources/app.asar

ç­‰ç­‰ï¼Œè¿™ä¸ªè·¯å¾„æœ‰ç‚¹é—®é¢˜ï¼Œ`distassets` ä¸­é—´æ˜¯ä¸æ˜¯å°‘äº†ä¸ª `/`ï¼Œå‰å¾€ `app/renderer/hooks`ï¼Œæ‰¾åˆ° `useReadDirAssetsTemplateHooks.ts` æ–‡ä»¶è¿›è¡Œä¿®æ”¹

![image.png](./images/24fdffc3d3b54b75f6d715b36849c763.webp )

è®©æˆ‘ä»¬èµ°ä¸€ä¸ªå®Œæ•´çš„æ‰“åŒ…æ„å»ºå‘½ä»¤

```js
// 1. åˆ é™¤ä¸Šä¸€è½®æ‰“åŒ…çš„ dist ç›®å½•
rm -rf dist
// 2. æ„å»ºæ‰“åŒ…Elctron
npm run build:main
// 3. æ„å»ºæ‰“åŒ… React
npm run build:render
// 4. é€šè¿‡ electron-builder æ„å»ºå®‰è£…åŒ…
//ï¼ˆå¦‚æœä½ çš„é™æ€èµ„æºæ²¡å‘ç”Ÿæ”¹å˜ï¼Œå¯ä»¥ç›´æ¥ packï¼Œä¸ç”¨å†é‡æ–°æ‰“åŒ…ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹ï¼‰
npm run pack
```

è¿›å…¥ `package/mac` åŒå‡»åº”ç”¨ç¨‹åºï¼Œè¿›å»åˆ°æ¨¡ç‰ˆåˆ—è¡¨é¡µé¢ï¼Œæ˜¯æ²¡é—®é¢˜çš„ã€‚

![image.png](./images/40bfc4d6842fb8087d28a597fed633b7.webp )

æ­¤æ—¶å†å»ç‚¹å‡»ç®€å†åˆ¶ä½œï¼Œä¹Ÿæ˜¯å¯è¡Œçš„ã€‚è‡³æ­¤æˆ‘ä»¬çš„æ‰“åŒ…é—®é¢˜å·²ç»å¾—åˆ°è§£å†³ã€‚

### ç¬¬å››æ­¥ï¼šWindow & Mac åŒç®¡é½ä¸‹

å‰é¢æˆ‘ä»¬æ˜¯æ ¹æ®æ–‡æ¡£ï¼Œåšäº†æœ€ä¸ºç®€å•çš„é…ç½®ï¼Œé€šè¿‡ electron-builder å®˜æ–¹æ–‡æ¡£ï¼Œ[å®ƒå£°æ˜](https://www.electron.build/cli.html#target)ï¼š

> Without target configuration, electron-builder builds Electron app for current platform and current architecture using default target.

ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ ä»€ä¹ˆéƒ½ä¸é…ç½®çš„æƒ…å†µä¸‹ï¼Œä¼šæ ¹æ®ä½ çš„ç³»ç»Ÿå¹³å°ï¼Œç»™ä½ æ‰“ä¸€ä¸ªé»˜è®¤çš„åŒ…ã€‚ä½†æˆ‘ä»¬å¾€å¾€æ˜¯å¸Œæœ›æ„å»ºæ—¶ï¼Œèƒ½ç”Ÿæˆå¤šå¹³å°çš„å®‰è£…åŒ…ã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬é…ç½®ä¸€ä¸‹å§ï¼Œæ›´å¤šå±æ€§å¯è‡ªè¡ŒæŸ¥é˜…æ–‡æ¡£

```json
{
  "build": {
    "appId": "visResumeMook.ElectronReact",
    "productName": "VisResumeMook",
    "copyright": "Copyright Â© 2019 ${author}",
    // åŒ…å«çš„æ–‡ä»¶ï¼Œè¿™ä¸ªåœ¨è§£å‹ asar æ—¶å¯ä»¥çœ‹åˆ°æºä»£ç 
    "files": ["dist/**/*", "package.json", "node_modules/"],
    // ç”Ÿæˆçš„å®‰è£…åŒ…è¾“å‡ºåˆ° package æ–‡ä»¶å¤¹
    "directories": {
      "output": "package"
    },
    "mac": {
      "target": ["dmg", "zip"],
      "category": "public.app-category.productivity"
    },
    "dmg": {
      // è¿™ä¸ªæ˜¯å®‰è£…æ—¶çš„å›¾æ ‡ä½ç½®
      "contents": [
        {
          "x": 130,
          "y": 220,
          "type": "link",
          "path": "/Applications"
        },
        {
          "x": 410,
          "y": 220,
          "type": "file"
        }
      ]
    },
    "win": {
      "target": ["msi", "nsis"]
    }
  }
}
```

è®©æˆ‘ä»¬èµ°ä¸€ä¸ªå®Œæ•´çš„æ‰“åŒ…æ„å»ºå‘½ä»¤

```js
// 1. åˆ é™¤ä¸Šä¸€è½®æ‰“åŒ…çš„ dist ç›®å½•å’Œ package ç›®å½•
rm -rf dist package
// 2. æ„å»ºæ‰“åŒ…Elctron
npm run build:main
// 3. æ„å»ºæ‰“åŒ… React
npm run build:render
// 4. âš ï¸ è¿™é‡Œæ˜¯è¦æ‰§è¡Œ distï¼Œç”ŸæˆçœŸæ­£çš„å®‰è£…åŒ…
npm run dist
```

ç»è¿‡ä¸€æ®µæ—¶é—´ç­‰å¾…ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‰“åŒ…å®Œæˆ

![image.png](./images/e75ead4cdc5a22fcb7e4e8972a603944.webp )

è®©æˆ‘ä»¬çœ‹çœ‹ `package` ä¸‹æœ‰ä»€ä¹ˆæ–‡ä»¶

![image.png](./images/963f68c454fb10e3b8f87e33691862b6.webp )

æœ‰ä¸€ä¸ª `zip` å’Œ `dmg`ï¼Œæˆ‘æ˜¯ Mac ç”µè„‘ï¼Œæ‰€ä»¥æˆ‘åŒå‡»æ‰“å¼€ dmg çš„å®‰è£…åŒ…è¿›è¡Œå®‰è£…

![image.png](./images/4e71732026ed008ac538826666b18d4f.webp )

å®‰è£…ä¹‹åå°±èƒ½æ„‰å¿«ä½¿ç”¨å•¦

![image.png](./images/0d629231131ba30eb8f10c02f623383e.webp )

## æ€»ç»“

æœ¬ç« èŠ‚å†…å®¹ç‰¹åˆ«å¤šï¼Œæ„å»ºè¿‡ç¨‹ä¹Ÿé‡åˆ°äº†è®¸å¤šçš„é—®é¢˜ï¼Œé˜¿å®½è®¤ä¸ºæœ€é‡è¦çš„æ˜¯å°ä¼™ä¼´ä»¬èƒ½ææ¸…æ¥š Electron ä¸ React çš„æ„å»ºå…³ç³»ï¼Œææ¸…æ¥šä¹‹åå†é€šè¿‡ `electron-builder` æ„å»ºæˆå®‰è£…åŒ…å³å¯ã€‚

å°ä¼™ä¼´ä»¬å¯ä»¥å†å›é¡¾ä¸€ä¸‹æœ¬ç« èŠ‚çš„æ•´ä½“å†…å®¹ï¼Œä»£ç å¯è§ğŸ‘‰ [chapter-22-build](https://github.com/PDKSophia/visResumeMook/tree/chapter-22-build)

![image.png](./images/3fbc60a0c90439fd3f9eaacbc063cd2f.webp )

åˆ°æ­¤ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„æ„å»ºå·²ç»“æŸã€‚ä½†äº‹æƒ…çœŸçš„å¦‚æ­¤ç®€å•å—ï¼Ÿ
