# 3.如何调试网页的 JS（以 React 为例）

上节我们知道了什么是调试、调试的原理，这节我们开始学习调试工具的使用。

首先从网页的 JS 调试开始。

我们以 React 项目为例，用 create-react-app 创建一个 react 项目：

```
yarn create react-app test-react-debug
```

进入项目目录，执行 `npm run start`。

它会启动一个开发服务，然后浏览器访问 localhost:3000：

![](./images/0ae1f772f4e792eb2438507cb399ece3.webp )

打开 Chrome DevTools，在 Sources 面板找到 src/index.js，打上个断点：

![](./images/d166e1d6b5619f2b6b7d66a0ca6be6a2.webp )

然后刷新就可以开始调试了：

![](./images/e671ddc6e5742226578b2a054d95b45f.webp )

代码会在断点处断住，右边会显示当前 local 作用域的变量，global 作用域的变量，还有调用栈 call stack。


![](./images/620c76c873990400d864f6a73664d306.webp )

上面有几个控制执行的按钮，分别是：

![](./images/2dcffa02bc8e38e5a9aaf20ab3144037.webp ) 恢复执行

![](./images/562beeae97f8ffce8b86caf715925793.webp ) 单步执行

![](./images/42ed0e42c9f1a7f996539eabfd544f0c.webp ) 进入函数调用

![](./images/0ad4da0f02bc43bbb3fde9edb7a61f95.webp ) 跳出函数调用


![](./images/886d330976107f6968258ff8c44e2ccc.webp ) 让断点失效

![](./images/d083ca641f9248eb8d5036daacc5b79d.webp ) 在异常处断住

**可以控制代码的执行，可以看到每一步的调用栈和作用域的变量，那理清代码的逻辑，或者排查代码中的问题不就很容易了么？**

其实调试网页的 JS，除了 Chrome DevTools 外，还有一种更好用的调试方式： VSCode Debugger。

用 VSCode 打开项目目录，创建 .vscode/launch.json 文件：

![](./images/cd03afa0ed4eea148fcdbadc335f2954.webp )

点击右下角的 Add Configuration... 按钮，选择 Chrome: Launch

![](./images/c11872f0ca87e3466345794d56804aa2.webp )

把访问的 url 改为开发服务器启动的地址：

![](./images/8986a918d15e42745d4d3e0f1cdb5845.webp )

然后进入 Debug 窗口，点击启动：

![](./images/ee3e7ca9fbff2d70c697972477b26e51.webp )

你会发现它启动了浏览器，并打开了这个 url：

![](./images/bb35fb1d500887c965dcaed64c08a605.webp )

VSCode 里还会有一排控制执行的按钮：

![](./images/00b000c01c820c6198f158ee5e5cefbf.webp )

在代码打个断点，然后点击 ![](./images/8f980b73c7bd612773d0baa7f4fb4ba6.webp )
 刷新：
 
![](./images/5eca3bb1e967d2d601d4c62860157eba.webp )

代码会执行到断点处断住，本地和全局作用域的变量，调用栈等都会展示在左边：


![](./images/abb375c4c7a133c390e9ceb0deeebc41.webp )

![](./images/16a7f4a277384a76a8dfc740307f2af9.webp )

上面的控制按钮分别对应恢复执行、单步执行、进入函数调用、跳出函数调用，这个和 Chrome DevTools 一样：

![](./images/0018a0bbd9b2a9fd0fe91db6ad3dacd9.webp )

还多了刷新和停止的按钮。

那异常断点的按钮呢？

被移到了这里：

![](./images/6a78dd72622a3a684ee147b137acd704.webp )

可以在被 catch 的异常处断住，也可以在没有被 catch 的异常处断住。

看起来和 Chrome DevTools 里调试差不多呀，在 VSCode Debugger 里调试有啥好处么？

好处是不用切换工具呀，之前是调试在 Chrome DevTools，写代码在 VSCode，而现在写代码和调试都可以在 VSCode 里，可以边调试边写代码。

比如我想访问 this 的某个属性，可以在 Debug Console 里输入 this 看下它的值，然后再来写代码：

![](./images/80dd6fb77187d4e1d406922177a29071.webp )

如果你用了 TypeScript 可能会有属性名的提示、属性值类型的提示，但并不知道属性的值是啥。

而边调试边写代码，能直接知道属性值是什么，有哪些函数可以调用。

**边调试边写代码是我推荐的写代码方式。**

知道了怎么用，我们再来思考下：为什么 Chrome DevTools 和 VSCode Debugger 都可以调试网页呢？

这是因为调试协议是一样的，都是 CDP。Chrome DevTools 可以对接 CDP 来调试网页，VSCode Debugger 也可以。只不过 VSCode Debugger 会多一层 Debug Adapter Protocol 的转换。

![](./images/0ba3159f68f52315dbc93b2ba75ef8f0.webp )

这也是为什么两个调试工具的功能大同小异。

## 总结

Chrome DevTools 和 VSCode Debugger 都能调试网页的 JS，可以打断点，单步执行，可以看到本地和全局作用域的变量，还有函数调用栈。

但我更推荐使用 VSCode Debugger 来调试，这样写代码和调试都用同一个工具，不用切换，而且还可以边调试边写代码。

这俩原理都是对接了 Chrome DevTools Protocol，用自己的 UI 来做展示和交互。

如果你还没用过 VSCode Debugger，不妨就从今天开始用起来吧。
